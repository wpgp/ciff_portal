<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script type="text/javascript" src="https://rawcdn.githack.com/chrisveness/crypto/7067ee62f18c76dd4a9d372a00e647205460b62b/sha1.js"></script>
    <title>Temporary</title>
  </head>
  <body>
    <div id="loginbox">
      <div class="container mt-3">
        <div class="d-flex align-middle justify-content-center border border-danger border-rounded p-3">
          <form action="#">
            <div class="col mb-3">
              <label for="pwd">Enter Password:</label>
              <input 
                type="password" class="form-control" id="pwd" 
                placeholder="&#x2022;&#x2022;&#x2022;"
              >
            </div>
            <div>
              <button 
                id="resetbutton" type="button" class="btn btn-sm btn-danger">
                Reset
              </button>
              <button 
                id="loginbutton" type="button" class="btn btn-sm btn-danger">
                Enter
              </button>  
            </div>
          </form>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      "use strict";

      function loadPage(pwd) {
        var hash = pwd;
        hash = Sha1.hash(pwd);
        var url = hash + "/";

        $.ajax({
          url : url,
          dataType : "html",
          success : function(data) {
            window.location = url;
          },
          error : function(xhr, ajaxOptions, thrownError) {
            console.log('error')
            parent.location.hash = hash;
            $("#pwd").attr("placeholder", "wrong password");
            $("#pwd").val("");
          }
        });
        }

      $("#loginbutton").on("click", function() {
        loadPage($("#pwd").val());
      });

      $("#resetbutton").on("click", function() {
        window.location = '/'
        $("#pwd").val("");
      });

      $("#pwd").keypress(function(e) {
        if (e.which == 13) {
          loadPage($("#pwd").val());
        }
      });

      //$("#pwd").focus();
    </script>

  </body>
</html>
